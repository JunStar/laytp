<div class="layui-header" style="z-index:99999!important;">
    <div class="fl header-logo">{$Think.config.laytp.basic.site_name}</div>
    <ul class="layui-nav fl nobg main-nav">
        {foreach $first_menu as $menu}
        <li class="layui-nav-item">
            <a href="javascript:;">
                <i class="{$menu['icon']}"></i> {$menu['name']}
            </a>
        </li>
        {/foreach}
    </ul>
    <ul class="layui-nav layui-layout-right head-info">
        {if $laytp_admin_user['is_super_manager']}
        <li class="layui-nav-item">
            <a href="javascript:void(0);" class="aicon ai-qingchu" id="laytp_clear_cache" title="清缓存"></a>
        </li>
        {/if}
        <li class="layui-nav-item">
            <a href="javascript:void(0);" class="aicon ai-suo" id="lock_screen" title="锁屏"></a>
        </li>
        <li class="layui-nav-item" style="padding: 0 15px">
            <a href="javascript:;">
                <img src="{$laytp_admin_user.avatar}" class="layui-nav-img">
                {$laytp_admin_user.nickname}
            </a>
            <dl class="layui-nav-child">
                <dd><a href="{:url('admin/general/profile')}">个人设置</a></dd>
                <dd><a href="{:url('admin/auth.login/logout')}">安全退出</a></dd>
            </dl>
        </li>
    </ul>
</div>

<div class="layui-side layui-bg-cyan">
    <div id="navBarId" class="layui-side-scroll"></div>
</div>

<style>
    #navBarId dl{
        background-color: var(--laytp-layui-nav-child-a-bg)!important;
    }
</style>

<script>
    // 导航菜单的间隔像素
    let menuCell = 5;

    layui.use('element', function(){
        let element = layui.element;
        let $ = layui.jquery;

        let data= '[{"name":"主页","url":"www.sys.com","childMenus":null},{"name":"系统设置","url":"www.sys.com","childMenus":[{"name":"权限模块","url":"www.sys.com","childMenus":null}]},{"name":"业务系统","url":"www.manager.com","childMenus":[{"name":"销售系统","url":"www.child01.com","childMenus":[{"name":"订单系统","url":"www.order.com","childMenus":[{"name":"未完成订单","url":"www.undo.com","childMenus":[{"name":"服装部订单","url":"www.clothes.com","childMenus":[{"name":"成人部分","url":"www.clothes.com","childMenus":null},{"name":"儿童部分","url":"www.clothes.com","childMenus":null}]},{"name":"玩具部订单","url":"www.clothes.com","childMenus":[{"name":"成人部分","url":"www.clothes.com","childMenus":null},{"name":"儿童部分","url":"www.clothes.com","childMenus":null}]}]}]},{"name":"结算系统","url":"www.order.com","childMenus":null}]},{"name":"公关系统","url":"www.child02.com","childMenus":null}]}]';
        data = JSON.parse(data);
        let liStr= "";
        // 遍历生成主菜单
        for( let i = 0; i <data.length; i++){
            // 判断是否存在子菜单
            if(data[i].childMenus!=null&&data[i].childMenus.length>0){
                liStr+="<li class=\"layui-nav-item\"><a class=\"\" href=\"javascript:;\"><i class='layui-icon' >&#xe653;</i> "+data[i].name+"</a>\n"+
                    "<dl class=\"layui-nav-child\">\n";
                // 遍历获取子菜单
                for( let k = 0; k <data[i].childMenus.length; k++){
                    liStr+=getChildMenu(data[i].childMenus[k],0);
                }
                liStr+="</dl></li>";
            }else{
                liStr+="<li class=\"layui-nav-item\"><a class=\"\" href=\"javascript:;\"><i class='layui-icon' >&#xe66c;</i> "+data[i].name+"</a></li>";
            }
        };
        $("#navBarId").html("<ul class=\"layui-nav layui-nav-tree\"  lay-filter=\"test\">\n" +liStr+"</ul>");
        element.init();
    });

    // 递归生成子菜单
    function getChildMenu(subMenu,num) {
        // console.log("num: "+num);
        num++;
        let subStr = "";
        if(subMenu.childMenus!=null&&subMenu.childMenus.length>0){
            subStr+="<dd><ul><li class=\"layui-nav-item\" ><a style=\"margin-Left:"+num*menuCell+"px\" class=\"\" href=\"javascript:;\"><i class='layui-icon' >&#xe653;</i> "+subMenu.name+"</a>" +
                "<dl class=\"layui-nav-child\">\n";
            for( let j = 0; j <subMenu.childMenus.length; j++){
                subStr+=getChildMenu(subMenu.childMenus[j],num);
            }
            subStr+="</dl></li></ul></dd>";
        }else{
            subStr+="<dd><a style=\"margin-Left:"+num*menuCell+"px\" href=\"javascript:;\"><i class='layui-icon' >&#xe66c;</i> "+subMenu.name+"</a></dd>";
        }
        return subStr;
    }

    layui.use('table', function(){
        let table = layui.table;

        table.render({
            elem: '#test'
            ,url:'common/userList'
            ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            ,cols: [[
                {field:'id', width:80, title: 'id', sort: true}
                ,{field:'lngCm', width:80, title: 'lngCm'}
                ,{field:'username', width:80, title: 'username', sort: true}
            ]]
            ,request:{
                pageName: 'curr' //页码的参数名称，默认：page
                ,limitName: 'nums' //每页数据量的参数名，默认：limit
            }
            //用于对返回的数据格式的自定义，如：
            ,response: {
                statusName: 'succ' //数据状态的字段名称，默认：code
                ,statusCode: 0 //成功的状态码，默认：0
                ,msgName: 'msg' //状态信息的字段名称，默认：msg
                ,countName: 'totalSize' //数据总数的字段名称，默认：count
                ,dataName: 'list' //数据列表的字段名称，默认：data
            }
        });
    });
</script>